var __defProp = Object.defineProperty;
var __getOwnPropSymbols = Object.getOwnPropertySymbols;
var __hasOwnProp = Object.prototype.hasOwnProperty;
var __propIsEnum = Object.prototype.propertyIsEnumerable;
var __defNormalProp = (obj, key, value) => key in obj ? __defProp(obj, key, { enumerable: true, configurable: true, writable: true, value }) : obj[key] = value;
var __spreadValues = (a, b) => {
  for (var prop in b || (b = {}))
    if (__hasOwnProp.call(b, prop))
      __defNormalProp(a, prop, b[prop]);
  if (__getOwnPropSymbols)
    for (var prop of __getOwnPropSymbols(b)) {
      if (__propIsEnum.call(b, prop))
        __defNormalProp(a, prop, b[prop]);
    }
  return a;
};

// src/index.ts
import plugin from "fastify-plugin";
var src_default = plugin((fastify, _options, done) => {
  fastify.decorate("locals", {}).addHook("onRequest", (_request, reply, done2) => {
    reply.locals = {
      serializedGlobals: {}
    };
    done2();
  }).decorateReply("marko", function(template, input) {
    const $global = __spreadValues(__spreadValues({}, fastify.locals), this.locals);
    if (input) {
      if (input.$global) {
        Object.assign($global, input.$global);
      }
      input.$global = $global;
    }
    return this.type("text/html; charset=utf-8").send(template.stream(input || { $global }));
  });
  done();
});
export {
  src_default as default
};
